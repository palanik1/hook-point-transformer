FILE:  ./katran-test/extraction/Makefile
[RUN_TXL] FILE:  ./katran-test/extraction/Makefile
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/Makefile
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/Makefile.orig
[RUN_TXL] FILE:  ./katran-test/extraction/Makefile.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/Makefile.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/Makefile.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/Makefile.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/Makefile.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_consts.h
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_consts.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_consts.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_consts.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_consts.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_consts.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_consts.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_consts.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_consts.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/balancer_helpers.h
+++ /tmp/cocci-output-451032-19bf41-balancer_helpers.h
@@ -6,6 +6,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_structs.h"
 #include "bpf.h"
FILE:  ./katran-test/extraction/balancer_helpers.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_helpers.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_helpers.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/balancer_helpers.h.orig
+++ /tmp/cocci-output-451042-5a68b9-balancer_helpers.h.orig
@@ -6,6 +6,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_structs.h"
 #include "bpf.h"
FILE:  ./katran-test/extraction/balancer_helpers.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_helpers.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_helpers.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/balancer_helpers.h.orig.orig
+++ /tmp/cocci-output-451052-1bcfb9-balancer_helpers.h.orig.orig
@@ -6,6 +6,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_structs.h"
 #include "bpf.h"
FILE:  ./katran-test/extraction/balancer_maps.h
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_maps.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_maps.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_maps.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_maps.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_maps.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_maps.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_maps.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_maps.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_structs.h
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_structs.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_structs.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_structs.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_structs.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_structs.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/balancer_structs.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/balancer_structs.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/balancer_structs.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/bpf.h
[RUN_TXL] FILE:  ./katran-test/extraction/bpf.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/bpf.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/bpf.h
+++ /tmp/cocci-output-451099-d5e3b7-bpf.h
@@ -1,6 +1,7 @@
 #ifndef _UAPI__LINUX_BPF_H__
 #define _UAPI__LINUX_BPF_H__
 #include <linux/types.h>
+#include <linux/pkt_cls.h>
 #include "bpf_common.h"
 #define BPF_JMP32 0x06 /* jmp mode in word width */
 #define BPF_ALU64 0x07 /* alu mode in double word width */
FILE:  ./katran-test/extraction/bpf_common.h
[RUN_TXL] FILE:  ./katran-test/extraction/bpf_common.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/bpf_common.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/bpf_endian.h
[RUN_TXL] FILE:  ./katran-test/extraction/bpf_endian.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/bpf_endian.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/bpf_endian.h
+++ /tmp/cocci-output-451113-252a2f-bpf_endian.h
@@ -1,6 +1,7 @@
 #ifndef __BPF_ENDIAN__
 #define __BPF_ENDIAN__
 #include <linux/swab.h>
+#include <linux/pkt_cls.h>
 #if __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__
 #define __bpf_ntohs(x) __builtin_bswap16(x)
 #define __bpf_htons(x) __builtin_bswap16(x)
FILE:  ./katran-test/extraction/bpf_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/bpf_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/bpf_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/control_data_maps.h
[RUN_TXL] FILE:  ./katran-test/extraction/control_data_maps.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/control_data_maps.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/control_data_maps.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/control_data_maps.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/control_data_maps.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/control_data_maps.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/control_data_maps.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/control_data_maps.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/csum_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/csum_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/csum_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/csum_helpers.h
+++ /tmp/cocci-output-451139-60c0d7-csum_helpers.h
@@ -7,6 +7,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_endian.h"
 #include "bpf_helpers.h"
FILE:  ./katran-test/extraction/csum_helpers.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/csum_helpers.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/csum_helpers.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/csum_helpers.h.orig
+++ /tmp/cocci-output-451149-ad5bf1-csum_helpers.h.orig
@@ -7,6 +7,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_endian.h"
 #include "bpf_helpers.h"
FILE:  ./katran-test/extraction/csum_helpers.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/csum_helpers.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/csum_helpers.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/csum_helpers.h.orig.orig
+++ /tmp/cocci-output-451159-121096-csum_helpers.h.orig.orig
@@ -7,6 +7,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_endian.h"
 #include "bpf_helpers.h"
FILE:  ./katran-test/extraction/decap_maps.h
[RUN_TXL] FILE:  ./katran-test/extraction/decap_maps.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/decap_maps.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/decap_maps.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/decap_maps.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/decap_maps.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/decap_maps.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/decap_maps.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/decap_maps.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/duplicates.out
[RUN_TXL] FILE:  ./katran-test/extraction/duplicates.out
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/duplicates.out
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/duplicates.out.orig
[RUN_TXL] FILE:  ./katran-test/extraction/duplicates.out.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/duplicates.out.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/duplicates.out.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/duplicates.out.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/duplicates.out.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/encap_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/encap_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/encap_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/encap_helpers.h
+++ /tmp/cocci-output-451193-8a3058-encap_helpers.h
@@ -6,6 +6,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "bpf.h"
 #include "bpf_endian.h"
FILE:  ./katran-test/extraction/encap_helpers.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/encap_helpers.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/encap_helpers.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/encap_helpers.h.orig
+++ /tmp/cocci-output-451203-b4a442-encap_helpers.h.orig
@@ -6,6 +6,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "bpf.h"
 #include "bpf_endian.h"
FILE:  ./katran-test/extraction/encap_helpers.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/encap_helpers.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/encap_helpers.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/encap_helpers.h.orig.orig
+++ /tmp/cocci-output-451213-f00204-encap_helpers.h.orig.orig
@@ -6,6 +6,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "bpf.h"
 #include "bpf_endian.h"
FILE:  ./katran-test/extraction/extracted.c
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.c
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.c
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/extracted.c
+++ /tmp/cocci-output-451223-d2bea2-extracted.c
@@ -86,6 +86,7 @@
 #include <linux/version.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 
 __attribute__ ((__always_inline__)) static inline int process_l3_headers (struct packet_description *pckt, __u8 *protocol, __u64 off, __u16 *pkt_bytes, void *data, void *data_end, bool is_ipv6) {
     __u64 iph_len;
FILE:  ./katran-test/extraction/extracted.c.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.c.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.c.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/extracted.c.orig
+++ /tmp/cocci-output-451233-46b3d3-extracted.c.orig
@@ -86,6 +86,7 @@
 #include <linux/version.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 
 __attribute__ ((__always_inline__)) static inline int process_l3_headers (struct packet_description *pckt, __u8 *protocol, __u64 off, __u16 *pkt_bytes, void *data, void *data_end, bool is_ipv6) {
     __u64 iph_len;
FILE:  ./katran-test/extraction/extracted.c.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.c.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.c.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/extracted.c.orig.orig
+++ /tmp/cocci-output-451243-29dc83-extracted.c.orig.orig
@@ -86,6 +86,7 @@
 #include <linux/version.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 
 __attribute__ ((__always_inline__)) static inline int process_l3_headers (struct packet_description *pckt, __u8 *protocol, __u64 off, __u16 *pkt_bytes, void *data, void *data_end, bool is_ipv6) {
     __u64 iph_len;
FILE:  ./katran-test/extraction/extracted.ll
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.ll
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.ll
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/extracted.ll.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.ll.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.ll.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/extracted.ll.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.ll.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.ll.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/extracted.o
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.o
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.o
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/extracted.o.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.o.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.o.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/extracted.o.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/extracted.o.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/extracted.o.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug.h
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/flow_debug_helpers.h
+++ /tmp/cocci-output-451293-7ba698-flow_debug_helpers.h
@@ -8,6 +8,7 @@
 #include <linux/udp.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "flow_debug_maps.h"
 
 __attribute__ ((__always_inline__)) static inline __u32 get_next_ports (void *transport_hdr, __u8 proto, void *data_end) {
FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/flow_debug_helpers.h.orig
+++ /tmp/cocci-output-451304-b7b05d-flow_debug_helpers.h.orig
@@ -8,6 +8,7 @@
 #include <linux/udp.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "flow_debug_maps.h"
 
 __attribute__ ((__always_inline__)) static inline __u32 get_next_ports (void *transport_hdr, __u8 proto, void *data_end) {
FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_helpers.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/flow_debug_helpers.h.orig.orig
+++ /tmp/cocci-output-451314-58a0f1-flow_debug_helpers.h.orig.orig
@@ -8,6 +8,7 @@
 #include <linux/udp.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "flow_debug_maps.h"
 
 __attribute__ ((__always_inline__)) static inline __u32 get_next_ports (void *transport_hdr, __u8 proto, void *data_end) {
FILE:  ./katran-test/extraction/flow_debug_maps.h
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_maps.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_maps.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug_maps.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_maps.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_maps.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/flow_debug_maps.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/flow_debug_maps.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/flow_debug_maps.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/handle_icmp.h
[RUN_TXL] FILE:  ./katran-test/extraction/handle_icmp.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/handle_icmp.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/handle_icmp.h
+++ /tmp/cocci-output-451336-dd5a68-handle_icmp.h
@@ -8,6 +8,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/handle_icmp.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/handle_icmp.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/handle_icmp.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/handle_icmp.h.orig
+++ /tmp/cocci-output-451346-51a39a-handle_icmp.h.orig
@@ -8,6 +8,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/handle_icmp.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/handle_icmp.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/handle_icmp.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/handle_icmp.h.orig.orig
+++ /tmp/cocci-output-451356-59c337-handle_icmp.h.orig.orig
@@ -8,6 +8,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/healthchecking_consts.h
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_consts.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_consts.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_consts.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_consts.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_consts.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_consts.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_consts.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_consts.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_helpers.h
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_helpers.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_helpers.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/healthchecking_helpers.h
+++ /tmp/cocci-output-451378-c63cc3-healthchecking_helpers.h
@@ -10,6 +10,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_helpers.h"
 #include "encap_helpers.h"
FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/healthchecking_helpers.h.orig
+++ /tmp/cocci-output-451388-28b63a-healthchecking_helpers.h.orig
@@ -10,6 +10,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_helpers.h"
 #include "encap_helpers.h"
FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_helpers.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/healthchecking_helpers.h.orig.orig
+++ /tmp/cocci-output-451399-301ec6-healthchecking_helpers.h.orig.orig
@@ -10,6 +10,7 @@
 #include <stdbool.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "bpf.h"
 #include "bpf_helpers.h"
 #include "encap_helpers.h"
FILE:  ./katran-test/extraction/healthchecking_maps.h
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_maps.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_maps.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_maps.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_maps.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_maps.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_maps.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_maps.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_maps.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_structs.h
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_structs.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_structs.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_structs.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_structs.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_structs.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/healthchecking_structs.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/healthchecking_structs.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/healthchecking_structs.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/introspection.h
[RUN_TXL] FILE:  ./katran-test/extraction/introspection.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/introspection.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/introspection.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/introspection.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/introspection.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/introspection.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/introspection.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/introspection.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/jhash.h
[RUN_TXL] FILE:  ./katran-test/extraction/jhash.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/jhash.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/jhash.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/jhash.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/jhash.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/jhash.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/jhash.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/jhash.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
FILE:  ./katran-test/extraction/pckt_encap.h
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_encap.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_encap.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_encap.h
+++ /tmp/cocci-output-451458-24c890-pckt_encap.h
@@ -5,6 +5,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/pckt_encap.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_encap.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_encap.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_encap.h.orig
+++ /tmp/cocci-output-451468-bb0406-pckt_encap.h.orig
@@ -5,6 +5,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/pckt_encap.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_encap.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_encap.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_encap.h.orig.orig
+++ /tmp/cocci-output-451478-78d685-pckt_encap.h.orig.orig
@@ -5,6 +5,7 @@
 #include <string.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "balancer_structs.h"
FILE:  ./katran-test/extraction/pckt_parsing.h
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_parsing.h
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_parsing.h
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_parsing.h
+++ /tmp/cocci-output-451488-037a89-pckt_parsing.h
@@ -13,6 +13,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "bpf.h"
FILE:  ./katran-test/extraction/pckt_parsing.h.orig
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_parsing.h.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_parsing.h.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_parsing.h.orig
+++ /tmp/cocci-output-451499-8b4043-pckt_parsing.h.orig
@@ -13,6 +13,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "bpf.h"
FILE:  ./katran-test/extraction/pckt_parsing.h.orig.orig
[RUN_TXL] FILE:  ./katran-test/extraction/pckt_parsing.h.orig.orig
[RUN_COCCINELLE] FILE:  ./katran-test/extraction/pckt_parsing.h.orig.orig
@xdpdrop@
@@
- XDP_PASS
+ TC_ACT_OK
@@

@@
- XDP_DROP
+ TC_ACT_SHOT

@rule3@
identifier p,c,fn;
type t;
struct ethhdr *e;
@@
t fn(struct __sk_buff *ctx){
...
- e->h_proto
+ ctx->protocol
...
}

@vlanproto@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_encapsulated_proto
+ ctx->vlan_proto
...>
}


@vlantci@
identifier p,c,fn;
type t;
struct vlan_hdr *v;
@@
t fn(struct xdp_md *ctx){
<...
- v->h_vlan_TCI
+ ctx->vlan_tci
...>
}



@addheader@
@@
#include <...>
+#include <linux/pkt_cls.h>

@removequeue@
identifier p,c,fn,ctx;
type t;
@@
static int __always_inline fn(struct xdp_md* ctx,...)
{
...
- ctx->rx_queue_index
+ ctx->blah
...
}

-----------------------------------------------------------------------
let's go
-----------------------------------------------------------------------
-----------------------------------------------------------------------
-----------------------------------------------------------------------
xdpdrop = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule starting on line 5 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
rule3 = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlanproto = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
vlantci = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
addheader = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
               with rule_elem: #include <...>
                                 >>> #include <linux/pkt_cls.h>
                               
               with binding: []
     binding out = []
-----------------------------------------------------------------------
removequeue = 
-----------------------------------------------------------------------
binding in = []
binding relevant in = []
-----------------------------------------------------------------------
Finished
-----------------------------------------------------------------------
--- ./katran-test/extraction/pckt_parsing.h.orig.orig
+++ /tmp/cocci-output-451509-13f69a-pckt_parsing.h.orig.orig
@@ -13,6 +13,7 @@
 #include <stddef.h>
 #include <linux/pkt_cls.h>
 #include <linux/pkt_cls.h>
+#include <linux/pkt_cls.h>
 #include "balancer_consts.h"
 #include "balancer_helpers.h"
 #include "bpf.h"
